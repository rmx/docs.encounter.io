<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="generator" content="nanoc 3.2.4">

    <title>encounter docs - encounter docs - events</title>
    <link rel="stylesheet" type="text/css" href="/assets/screen.css" media="screen">
    <link rel="stylesheet" type="text/css" href="/assets/pygments.css" media="screen">

    <script type="text/javascript" src="//use.typekit.com/nli5ftd.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body>
<header>
    <div class='container'>
        <a href="/" class="logo"><span>docs.</span>encounter<span>.io</span></a>
        <div class='divider-vertical'></div>
        <ul id="menu" class="normal">
            <li><a href="http://encounter.io" class="minibutton"><span>encounter.io</span></a></li>
        </ul>
    </div>
</header>

<div class="container">
<div id="content">
    <div id="sidebar">
        <a href="/">Introduction</a>

        <h2>Overview</h2>
        <ul>
            <li><a href="/state-machine/">State Machine</a></li>
            <li><a href="/events/">Events</a></li>
            <li><a href="/terrain/">Terrain</a></li>
            <li><a href="/game-mechanics/">Game Mechanics</a></li>
        </ul>

        <h2>Concepts</h2>
        <ul>
            <li><a href="/concepts/achievements/">Achievements</a></li>
            <li><a href="/concepts/modifiers/">Modifiers</a></li>
            <li><a href="/concepts/objectives/">Objectives</a></li>
            <li><a href="/concepts/randomness/">Randomness</a></li>
        </ul>

        <h2>API</h2>
        <ul>
            <li><a href="/api/">Overview</a></li>
            <li><a href="/api/ref/">Reference</a></li>
            <li><a href="/api/event/">Events</a></li>
        </ul>

        <h2>Scripts</h2>
        <ul>
            <li><a href="/scripts/achievement/">Achievement</a></li>
            <li><a href="/scripts/aura/">Aura</a></li>
            <li><a href="/scripts/behavior/">Behavior</a></li>
            <li><a href="/scripts/glue/">Glue</a></li>
            <li><a href="/scripts/spell/">Spell</a></li>
        </ul>

        <h2>Examples</h2>
        <ul>
            <li><a href="/examples/achievement/">Achievement</a></li>
        </ul>
    </div>

    <div id="docs">
        <h1>Events</h1>

<p>An event is a function name and arguments, which shall be called on a target
object at a certain point in the future. The event also includes information
about the origin and source objects. These are the objects which caused the
event to be generated.</p>

<p>You never directly create these events, but rather uses one of the many
wrappers that are available in a script context. This is to ensure that the
fields such as <code>source</code> and <code>origin</code> are properly set. It also makes it easier
because you don't have to worry about those.</p>

<h2>Event Handling</h2>

<p>All game state changes always start with a packet (e.g., <code>GAMETICK</code>,
<code>TELEPORT</code> or <code>CAST</code>).</p>

<p>All events scheduled with <code>scheduleEvent</code> are queued in a scheduler,
respecting the <code>executeAt</code> field of a <code>CombatLogEvent</code> as shown in the next
Figure.</p>

<p><img src="../assets/scheduler.png" alt="Scheduler"></p>

<p>If an event has <code>executeAt == tnow</code> a <code>GAMETICK</code> packet is emitted. For
illustrative purposes lets assume that <code>t1 = t2 = tnow</code> and we receive
a new packet (<code>CLE5</code>) with the same <code>executeAt</code> time. Note that a packet can
introduce now events as well. This results in the following situation</p>

<p><img src="../assets/scheduler_process.png" alt="Processing Scheduler"></p>

<p>All events that have to be processed in the current <code>GAMETICK</code> are inserted in
the Combat Log (oldest event will be processed first). Each entry is processed
independently and will affect the game state only after all events have been
processed:</p>

<p><img src="../assets/combatlog_process.png" alt="Processing CombatLog"></p>

<p>The event filter was introduced to provide a way for auras to react on events
in certain cases (e.g. a damage shield). More specifically an aura can</p>

<ul>
<li>modify the event arguments</li>
<li>post reaction events (directly inserted in Combat Log)</li>
</ul><p>When a Combat Log Event is processed the following stages are executed:</p>

<ul>
<li>Event source and target unit can react.</li>
<li>Apply the event (and all reactions) to the game state.</li>
<li>Check if any units are dead.</li>
</ul><p>In the case multiple auras are present, the following evaluation ordering is
used to resolve conflicts:</p>

<ul>
<li>Auras on the source unit, sorted by priority</li>
<li>Auras on the target unit, sorted by priority</li>
</ul>
    </div>
</div>
</div>

<footer>
<div class='container'>
    <span>Â© rmx inc.</span>
    <ul>
        <li>Powered by:</li>
        <li><a href="http://nanoc.stoneship.org/">nanoc</a><span>|</span></li>
        <li><a href="http://pages.github.com/">GitHub Pages</a></li>
    </ul>
</div>
</footer>

<script type="text/javascript">
    var _gauges = _gauges || [];
    (function() {
        var t   = document.createElement('script');
        t.type  = 'text/javascript';
        t.async = true;
        t.id    = 'gauges-tracker';
        t.setAttribute('data-site-id', '4f2db2f1844d52060d000035');
        t.src = '//secure.gaug.es/track.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(t, s);
    })();
</script>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script>
    var $window = $(window),
    $stickyEl = $('#sidebar');

    var elTop = $stickyEl.offset().top;

    $window.scroll(function() {
        var windowTop = $window.scrollTop();
        if ($window.height() < $stickyEl.height())
            return;

        if (windowTop > elTop || elTop - windowTop < 10) {
            $stickyEl.css({ position: 'fixed', top: '10px' })
        } else {
            $stickyEl.removeAttr('style')
        }
    });
</script>

</body>
</html>
